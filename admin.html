<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Viewer ë§í¬ ìƒì„±ê¸° (Admin)</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
  body { font-family: system-ui; background:#f3f4f6; margin:0; padding:20px; }
  .card {
    max-width:900px; margin:0 auto; background:#fff; border-radius:12px;
    padding:20px; box-shadow:0 8px 22px rgba(0,0,0,0.08);
  }
  label { font-size:14px; font-weight:600; margin-top:12px; display:block; }
  input {
    width:100%; padding:10px; border:1px solid #d1d5db; border-radius:8px;
    margin-top:4px; font-size:14px;
  }
  button {
    margin-top:16px; padding:10px 18px; border:none; border-radius:999px;
    background:#3b82f6; color:white; font-size:14px; cursor:pointer;
  }
  table { width:100%; border-collapse:collapse; margin-top:20px; font-size:13px; }
  th,td { border-bottom:1px solid #e5e7eb; padding:8px; }
  th { background:#f9fafb; font-weight:600; }
  .btn-sm {
    padding:4px 10px; border-radius:999px; border:none; cursor:pointer;
    font-size:12px;
  }
  .open { background:#e5e7eb; }
  .copy { background:#3b82f6; color:white; }
  .del { background:#fee2e2; color:#b91c1c; }
</style>
</head>

<body>
<div class="card">
  <h2>ğŸ“Œ Viewer ë§í¬ ìƒì„±ê¸° (ê´€ë¦¬ì í˜ì´ì§€)</h2>

  <label>ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë§í¬ ë˜ëŠ” ID</label>
  <input id="sheetInput" placeholder="ì „ì²´ ë§í¬ ë˜ëŠ” ìŠ¤í”„ë ˆë“œì‹œíŠ¸ IDë§Œ ì…ë ¥">

  <label>í‘œì‹œë  í˜ì´ì§€ ì œëª©</label>
  <input id="titleInput" placeholder="ì˜ˆ: í˜¸ìŠ¤í…” 1ê¸° ì˜¨ë¼ì¸">

  <button onclick="generateLink()">ğŸ”— ë§í¬ ìƒì„± ë° ì €ì¥</button>

  <h3 style="margin-top:30px;">ğŸ“„ ì €ì¥ëœ ë§í¬ ëª©ë¡</h3>
  <div id="listArea"></div>
</div>

<script>
const STORAGE_KEY = "viewer_links_v1";
const VIEWER_BASE = "https://wfe2303-del.github.io/-attendance_register/viewer.html";

function extractId(text) {
  text = text.trim();
  const m = text.match(/\/d\/([a-zA-Z0-9-_]+)/);
  return m ? m[1] : text;
}

function loadLinks() {
  const raw = localStorage.getItem(STORAGE_KEY);
  return raw ? JSON.parse(raw) : [];
}

function saveLinks(list) {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(list));
}

function renderList() {
  const list = loadLinks();
  if (!list.length) {
    document.getElementById("listArea").innerHTML = "<p>ì €ì¥ëœ ë§í¬ ì—†ìŒ</p>";
    return;
  }

  let html = `<table>
    <thead>
      <tr><th>#</th><th>ì œëª©</th><th>URL</th><th>ê´€ë¦¬</th></tr>
    </thead><tbody>`;

  list.forEach((item, idx) => {
    html += `
      <tr>
        <td>${idx + 1}</td>
        <td>${item.title}</td>
        <td style="word-break:break-all;">${item.url}</td>
        <td>
          <button class="btn-sm open" onclick="openLink(${idx})">ì—´ê¸°</button>
          <button class="btn-sm copy" onclick="copyLink(${idx})">ë³µì‚¬</button>
          <button class="btn-sm del" onclick="deleteLink(${idx})">ì‚­ì œ</button>
        </td>
      </tr>`;
  });

  html += "</tbody></table>";
  document.getElementById("listArea").innerHTML = html;
}

function generateLink() {
  const sheetRaw = document.getElementById("sheetInput").value;
  const title = document.getElementById("titleInput").value;

  if (!sheetRaw || !title) return alert("ë‘˜ ë‹¤ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.");

  const id = extractId(sheetRaw);
  const url = `${VIEWER_BASE}?id=${id}&title=${encodeURIComponent(title)}`;

  const list = loadLinks();
  list.push({ id, title, url });
  saveLinks(list);

  renderList();
  alert("ìƒì„± ì™„ë£Œ!");
}

function copyLink(idx) {
  const url = loadLinks()[idx].url;
  navigator.clipboard.writeText(url);
  alert("ë³µì‚¬ë¨!");
}

function openLink(idx) {
  window.open(loadLinks()[idx].url, "_blank");
}

function deleteLink(idx) {
  const list = loadLinks();
  list.splice(idx, 1);
  saveLinks(list);
  renderList();
}

renderList();
</script>
</body>
</html>

